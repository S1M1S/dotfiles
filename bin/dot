#!/bin/bash
DF="$HOME/dotfiles"

CONF_DIR="$HOME/.config"
DF_CONF_DIR="$DF/.config"

function clink {
  echo "linking up: $1"

  SRC="$DF/$1"
  DEST="$HOME/$1"

  rm -rf "$DEST" &> /dev/null
  ln -s "$SRC" "$DEST"
}

function configlink {
  echo "linking up: $1"

  SRC="$DF_CONF_DIR/$1/$2"
  DEST_DIR="$CONF_DIR/$1"
  DEST="$DEST_DIR/$2"

  if ! [[ -d "$DEST_DIR" ]]; then
    mkdir "$DEST_DIR" &> /dev/null
  fi
  rm "$DEST" &> /dev/null

  ln -s "$SRC" "$DEST"
}

if [[ "$1" == "link" ]]; then
  # dot link

  LINKS=(".vim" ".vimrc" ".zshrc" ".tmux.conf" "bin")
  for l in $LINKS[@]
  do
    clink "$l"
  done

  configlink "kitty" "kitty.conf"
  configlink "nvim" "init.vim"

elif [[ "$1" == "update" || "$1" == "up" ]]; then
  # dot update

  git -C "$DF" pull
  . ali refresh

else
  # dot

  echo "USAGE: "
  echo "dot link    -> make symlinks in home directory"
  echo "dot update  -> run git pull on the dotfile directory"
fi

