#!/bin/bash
DF="$HOME/dotfiles"

CONF_DIR="$HOME/.config"
DF_CONF_DIR="$DF/.config"

function folder_link {
  echo "linking up: $1"

  SRC="$DF/$1"
  DEST="$HOME/$1"

  rm -rf "$DEST" &> /dev/null
  ln -s "$SRC" "$DEST"
}

function config_link {
  echo "linking up: $1"

  SRC="$DF_CONF_DIR/$1"
  DEST="$CONF_DIR/$1"

  rm -r "$DEST" &> /dev/null

  ln -s "$SRC" "$DEST"
}

function link_all {
  links=(.zshrc .tmux.conf .p10k.zsh .fdignore)
  for l in ${links[@]}; do
    folder_link "$l"
  done

  links=(fontconfig gammastep goneovim kitty nvim sway waybar)
  for l in ${links[@]}; do
    config_link "$l"
  done
}

if [[ $1 == "link" ]]; then
  # dot link

  link_all
elif [[ $1 == "get" ]]; then
  # dot get $2

  . dot_get $2
elif [[ $1 == "update" || $1 == "up" ]]; then
  # dot update

  git -C "$DF" pull
else
  # dot

  echo "USAGE: "
  echo "dot link    -> make symlinks in home directory"
  echo "dot update  -> run git pull on the dotfile directory"

  NO_REFRESH=1
fi

if ! [[ $NO_REFRESH = 1 ]]; then
  . ali refresh
fi
